<!DOCTYPE html>
<html>
<head>
  <title>GW Drive Viewer</title>
  <script src="https://apis.google.com/js/api.js"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
  <h1>Gulf Waters Shared Files</h1>
  <div id="g_id_onload"
       data-client_id="729607447206-ii0q78e7880g36se8t9ahv3u27reqgl0.apps.googleusercontent.com"
       data-context="signin"
       data-ux_mode="popup"
       data-callback="handleCredentialResponse"
       data-auto_prompt="false">
  </div>
  <div class="g_id_signin"
       data-type="standard"
       data-size="large"
       data-theme="outline"
       data-text="sign_in_with"
       data-shape="rectangular"
       data-logo_alignment="left">
  </div>

  <ul id="fileList"></ul>

  <script>
    const FOLDER_ID = '13hmrLh8V3xJut6h7n1q2gF21XwYdfPDR';

    function handleCredentialResponse(response) {
      const jwt = response.credential;
      // Initialize GAPI after login
      gapi.load('client', () => {
        gapi.client.init({
          apiKey: 'AIzaSyDp4Y2uWMwLBY5nI0d8LUeRYqPZ7nHQUcI', // optional if not using public folder fallback
          clientId: 'YOUR_CLIENT_ID_HERE',
          scope: 'https://www.googleapis.com/auth/drive.readonly',
        }).then(() => {
          gapi.auth.setToken({access_token: jwt});
          listDriveFiles();
        });
      });
    }

    function listDriveFiles() {
      gapi.client.drive.files.list({
        q: `'${FOLDER_ID}' in parents and trashed = false`,
        fields: 'files(id, name, mimeType, webViewLink)',
        pageSize: 100
      }).then(response => {
        const files = response.result.files;
        const list = document.getElementById('fileList');
        list.innerHTML = '';
        if (!files || files.length === 0) {
          list.innerHTML = '<li>No files found.</li>';
          return;
        }
        files.forEach(file => {
          const item = document.createElement('li');
          item.innerHTML = `<a href="${file.webViewLink}" target="_blank">${file.name}</a>`;
          list.appendChild(item);
        });
      }, error => {
        console.error('Error fetching files:', error);
        alert('Failed to load files. See console.');
      });
    }
  </script>
</body>
</html>
